<!DOCTYPE html>
<html>
<head>
  <style>
    /* Modern Design System Variables */
    :root {
      /* Core colors */
      --primary-gradient: linear-gradient(135deg, #3A36DB, #7A53FB);
      --secondary-gradient: linear-gradient(135deg, #FF6B6B, #FF9E7D);
      
      /* Light theme */
      --bg-color: #FFFFFF;
      --card-bg: #F9FAFC;
      --text-color: #1A1A2E;
      --text-secondary: #64748B;
      --border-color: #E2E8F0;
      --primary-color: #5B55E3;
      --primary-hover: #4842C9;
      --secondary-color: #FF7B6B;
      --accent-color: #00D2D3;
      --tag-bg: #EEF2FF;
      --tag-color: #4842C9;
      --success-color: #10B981;
      --warning-color: #F59E0B;
      --error-color: #EF4444;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --radius-sm: 6px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-full: 9999px;
    }
    
    /* Dark theme */
    .dark-theme {
      --bg-color: #0F172A;
      --card-bg: #1E293B;
      --text-color: #F1F5F9;
      --text-secondary: #94A3B8;
      --border-color: #334155;
      --primary-color: #6366F1;
      --primary-hover: #818CF8;
      --secondary-color: #FF7B6B;
      --accent-color: #22D3EE;
      --tag-bg: #3B3EE2;
      --tag-color: #EEF2FF;
      --success-color: #34D399;
      --warning-color: #FBBF24;
      --error-color: #F87171;
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.12);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
    }
    
    /* Base Styles */
    * {
      box-sizing: border-box;
      transition: background-color 0.2s, color 0.2s, border-color 0.2s, opacity 0.2s, transform 0.2s;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      margin: 0;
      padding: 0;
      color: var(--text-color);
      background-color: var(--bg-color);
      overflow: hidden;
      height: 100vh;
      font-size: 14px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* Container and Layout */
    .container {
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .header {
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid var(--border-color);
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo-icon {
      width: 28px;
      height: 28px;
      border-radius: var(--radius-sm);
      background: var(--primary-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
    }
    
    .tagline {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 2px;
    }
    
    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    /* Resizable handle - only visible when hovered */
    .resize-handle {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 16px;
      height: 16px;
      cursor: nwse-resize;
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .resize-handle:after {
      content: '';
      position: absolute;
      right: 4px;
      bottom: 4px;
      width: 8px;
      height: 8px;
      border-right: 2px solid var(--text-secondary);
      border-bottom: 2px solid var(--text-secondary);
      opacity: 0.6;
    }
    
    .container:hover .resize-handle {
      opacity: 1;
    }
    
    /* Icons and buttons */
    .icon-btn {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background-color: transparent;
      color: var(--text-secondary);
      border: none;
      position: relative;
      outline: none;
    }
    
    .icon-btn:hover {
      background-color: var(--card-bg);
      color: var(--text-color);
    }
    
    .icon-btn svg {
      width: 18px;
      height: 18px;
    }
    
    /* Layer info card */
    .layer-card {
      background-color: var(--card-bg);
      border-radius: var(--radius-md);
      padding: 14px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: var(--shadow-sm);
      animation: slideIn 0.3s ease-out;
    }
    
    .layer-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: var(--primary-gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      flex-shrink: 0;
    }
    
    .layer-details {
      overflow: hidden;
    }
    
    .layer-name {
      font-weight: 600;
      font-size: 15px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .layer-type {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 2px;
    }
    
    /* Form elements */
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-group:last-child {
      margin-bottom: 0;
    }
    
    .input-label {
      display: block;
      margin-bottom: 6px;
      font-size: 13px;
      font-weight: 500;
      color: var(--text-color);
    }
    
    .input-field {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 14px;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: all 0.2s;
    }
    
    .input-field:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
    }
    
    .textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    /* URL actions */
    .url-actions {
      display: flex;
      gap: 8px;
      margin-top: 10px;
    }
    
    .action-btn {
      display: inline-flex;
      align-items: center;
      font-size: 13px;
      color: var(--primary-color);
      padding: 8px 12px;
      border-radius: var(--radius-md);
      cursor: pointer;
      background-color: var(--tag-bg);
      border: none;
      font-weight: 500;
      gap: 6px;
    }
    
    .action-btn:hover {
      background-color: rgba(99, 102, 241, 0.15);
      transform: translateY(-1px);
    }
    
    .action-btn:active {
      transform: translateY(0);
    }
    
    /* Tags */
    .tags-input-wrapper {
      position: relative;
    }
    
    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      min-height: 32px;
    }
    
    .tag {
      background-color: var(--tag-bg);
      color: var(--tag-color);
      padding: 6px 10px;
      border-radius: var(--radius-full);
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      box-shadow: var(--shadow-sm);
      animation: scaleIn 0.2s ease-out;
    }
    
    .tag-remove {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background-color: rgba(255, 255, 255, 0.2);
      cursor: pointer;
      font-size: 14px;
      line-height: 1;
    }
    
    .tag-remove:hover {
      background-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }
    
    /* Better tag suggestions */
    .tag-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 150px;
      overflow-y: auto;
      background-color: var(--bg-color);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      z-index: 10;
      margin-top: 5px;
      display: none;
    }
    
    .tag-suggestion-item {
      padding: 8px 12px;
      cursor: pointer;
      transition: all 0.1s;
    }
    
    .tag-suggestion-item:hover {
      background-color: var(--card-bg);
    }
    
    .tag-suggestion-item.active {
      background-color: var(--tag-bg);
      color: var(--tag-color);
    }
    
    /* Primary button */
    .primary-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--primary-gradient);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      width: 100%;
      gap: 8px;
      box-shadow: var(--shadow-md);
      margin-top: 8px;
    }
    
    .primary-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }
    
    .primary-btn:active {
      transform: translateY(0);
      box-shadow: var(--shadow-sm);
    }
    
    /* Status indicator */
    .status-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 12px;
      justify-content: center;
    }
    
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    
    .status-dot.saved {
      background-color: var(--success-color);
    }
    
    .status-dot.unsaved {
      background-color: var(--warning-color);
    }
    
    /* Messages */
    .message {
      padding: 14px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: flex-start;
      gap: 12px;
      animation: fadeIn 0.3s ease-out;
    }
    
    .message.info {
      background-color: rgba(99, 102, 241, 0.1);
      border-left: 3px solid var(--primary-color);
    }
    
    .message.warning {
      background-color: rgba(245, 158, 11, 0.1);
      border-left: 3px solid var(--warning-color);
    }
    
    .message.success {
      background-color: rgba(16, 185, 129, 0.1);
      border-left: 3px solid var(--success-color);
    }
    
    .message-icon {
      flex-shrink: 0;
      color: var(--primary-color);
    }
    
    .message.warning .message-icon {
      color: var(--warning-color);
    }
    
    .message.success .message-icon {
      color: var(--success-color);
    }
    
    .message-content {
      flex: 1;
    }
    
    .message-title {
      font-weight: 600;
      margin-bottom: 2px;
    }
    
    .message-text {
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    /* Settings panel */
    .settings-panel {
      position: absolute;
      top: 60px;
      right: 20px;
      background-color: var(--bg-color);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      padding: 16px;
      z-index: 100;
      width: 260px;
      border: 1px solid var(--border-color);
      animation: fadeInDown 0.2s ease-out;
      display: none;
    }
    
    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }
    
    .settings-title {
      font-size: 15px;
      font-weight: 600;
    }
    
    .close-btn {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      color: var(--text-secondary);
      background-color: transparent;
      border: none;
    }
    
    .close-btn:hover {
      background-color: var(--card-bg);
      color: var(--text-color);
    }
    
    .settings-group {
      margin-bottom: 16px;
    }
    
    .settings-group:last-child {
      margin-bottom: 0;
    }
    
    .settings-label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      font-weight: 500;
    }
    
    .toggle-group {
      display: flex;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      overflow: hidden;
    }
    
    .toggle-option {
      flex: 1;
      text-align: center;
      padding: 8px;
      font-size: 13px;
      cursor: pointer;
      background-color: var(--bg-color);
      color: var(--text-secondary);
      font-weight: 500;
      position: relative;
      z-index: 1;
    }
    
    .toggle-option.active {
      color: white;
    }
    
    .toggle-option.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--primary-gradient);
      z-index: -1;
    }
    
    /* Switch for toggle */
    .switch-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .switch-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--border-color);
      transition: .3s;
      border-radius: 34px;
    }
    
    .switch-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .3s;
      border-radius: 50%;
    }
    
    input:checked + .switch-slider {
      background: var(--primary-gradient);
    }
    
    input:focus + .switch-slider {
      box-shadow: 0 0 1px var(--primary-color);
    }
    
    input:checked + .switch-slider:before {
      transform: translateX(20px);
    }
    
    /* Landscape layout */
    .landscape-container {
      flex-direction: row;
      height: 100vh;
    }
    
    .landscape-sidebar {
      width: 280px;
      border-right: 1px solid var(--border-color);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .landscape-main {
      flex: 1;
      height: 100vh;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background-color: var(--card-bg);
      border-radius: var(--radius-md);
      padding: 12px 20px;
      box-shadow: var(--shadow-lg);
      font-size: 13px;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      border: 1px solid var(--border-color);
    }
    
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    
    .toast-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: var(--success-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes fadeInDown {
      from { 
        opacity: 0;
        transform: translateY(-10px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes slideIn {
      from { 
        opacity: 0;
        transform: translateY(10px);
      }
      to { 
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes scaleIn {
      from { 
        opacity: 0;
        transform: scale(0.8);
      }
      to { 
        opacity: 1;
        transform: scale(1);
      }
    }
    
    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }
    
    .pulse {
      animation: pulse 1.5s infinite;
    }
    
    /* Empty state */
    .empty-state {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px 0;
      text-align: center;
    }
    
    .empty-state-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--tag-bg);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      color: var(--primary-color);
    }
    
    .empty-state-text {
      font-size: 15px;
      font-weight: 500;
      margin-bottom: 8px;
    }
    
    .empty-state-subtext {
      font-size: 13px;
      color: var(--text-secondary);
      max-width: 260px;
    }
  </style>
</head>
<body>
  <!-- Portrait Layout -->
  <div id="portrait-container" class="container">
    <div class="header">
      <div class="logo">
        <div class="logo-icon">DT</div>
        <div class="tagline">Manage inspiration sources & references</div>
      </div>
      
      <button id="settings-trigger" class="icon-btn">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
        </svg>
      </button>
    </div>
    
    <div class="main-content">
      <div id="message-container"></div>
      
      <div id="layer-info" class="layer-card" style="display: none;">
        <div class="layer-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
            <line x1="8" y1="2" x2="8" y2="18"></line>
            <line x1="16" y1="6" x2="16" y2="22"></line>
          </svg>
        </div>
        <div class="layer-details">
          <div id="layerName" class="layer-name">Layer name</div>
          <div class="layer-type">Selected Element</div>
        </div>
      </div>
      
      <div id="metadata-form">
        <div class="form-group">
          <label for="sourceUrl" class="input-label">Source URL</label>
          <input type="url" id="sourceUrl" class="input-field" placeholder="https://..." />
          <div class="url-actions">
            <button id="openLink" class="action-btn" style="display: none;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
              Open link
            </button>
            <button id="copyLink" class="action-btn" style="display: none;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy link
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label for="tagInput" class="input-label">Tags</label>
          <div class="tags-input-wrapper">
            <input type="text" id="tagInput" class="input-field" placeholder="Add tags... (press Enter)" />
            <div id="tagSuggestions" class="tag-suggestions"></div>
            <div id="tagsContainer" class="tags-container"></div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="notes" class="input-label">Notes</label>
          <textarea id="notes" class="input-field textarea" placeholder="Add your notes..."></textarea>
        </div>
        
        <button id="saveBtn" class="primary-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
            <polyline points="17 21 17 13 7 13 7 21"></polyline>
            <polyline points="7 3 7 8 15 8"></polyline>
          </svg>
          Save Metadata
        </button>
        
        <div id="status-indicator" class="status-indicator" style="display: none;">
          <span class="status-dot unsaved"></span>
          <span>Draft saved automatically</span>
        </div>
      </div>
      
      <!-- Empty state - shown when no layer is selected -->
      <div id="empty-state" class="empty-state" style="display: none;">
        <div class="empty-state-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
          </svg>
        </div>
        <div class="empty-state-text">Select an element to begin</div>
        <div class="empty-state-subtext">Click on any layer in your design to add reference metadata</div>
      </div>
    </div>
    
    <div class="resize-handle" id="resize-handle"></div>
  </div>
  
  <!-- Landscape Layout -->
  <div id="landscape-container" class="landscape-container" style="display: none;">
    <div class="landscape-sidebar">
      <div class="header">
        <div class="logo">
          <div class="logo-icon">DT</div>
        </div>
        <button id="landscape-settings-trigger" class="icon-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
          </svg>
        </button>
      </div>
      
      <div id="landscape-layer-info" class="layer-card" style="margin: 16px; display: none;">
        <div class="layer-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="1 6 1 22 8 18 16 22 23 18 23 2 16 6 8 2 1 6"></polygon>
            <line x1="8" y1="2" x2="8" y2="18"></line>
            <line x1="16" y1="6" x2="16" y2="22"></line>
          </svg>
        </div>
        <div class="layer-details">
          <div id="landscapeLayerName" class="layer-name">Layer name</div>
          <div class="layer-type">Selected Element</div>
        </div>
      </div>
      
      <div class="main-content">
        <div id="landscape-message-container"></div>
        
        <div class="form-group">
          <label for="landscapeSourceUrl" class="input-label">Source URL</label>
          <input type="url" id="landscapeSourceUrl" class="input-field" placeholder="https://..." />
          <div class="url-actions">
            <button id="landscapeOpenLink" class="action-btn" style="display: none;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
              Open
            </button>
            <button id="landscapeCopyLink" class="action-btn" style="display: none;">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
          </div>
        </div>
        
        <div class="form-group">
          <label for="landscapeTagInput" class="input-label">Tags</label>
          <div class="tags-input-wrapper">
            <input type="text" id="landscapeTagInput" class="input-field" placeholder="Add tags... (press Enter)" />
            <div id="landscapeTagSuggestions" class="tag-suggestions"></div>
            <div id="landscapeTagsContainer" class="tags-container"></div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="landscape-main">
      <div id="landscape-empty-state" class="empty-state" style="display: none;">
        <div class="empty-state-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
          </svg>
        </div>
        <div class="empty-state-text">Select an element to begin</div>
        <div class="empty-state-subtext">Click on any layer in your design to add reference metadata</div>
      </div>
      
      <div class="form-group">
        <label for="landscapeNotes" class="input-label">Notes</label>
        <textarea id="landscapeNotes" class="input-field textarea" rows="10" placeholder="Add your notes..."></textarea>
      </div>
      
      <button id="landscapeSaveBtn" class="primary-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
          <polyline points="17 21 17 13 7 13 7 21"></polyline>
          <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
        Save Metadata
      </button>
      
      <div id="landscape-status-indicator" class="status-indicator" style="display: none;">
        <span class="status-dot unsaved"></span>
        <span>Draft saved automatically</span>
      </div>
    </div>
    
    <div class="resize-handle" id="landscape-resize-handle"></div>
  </div>
  
  <!-- Settings Panel -->
  <div id="settings-panel" class="settings-panel">
    <div class="settings-header">
      <div class="settings-title">Plugin Settings</div>
      <button id="close-settings" class="close-btn">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    
    <div class="settings-group">
      <label class="settings-label">Layout</label>
      <div class="toggle-group">
        <div class="toggle-option active" data-value="portrait">Portrait</div>
        <div class="toggle-option" data-value="landscape">Landscape</div>
      </div>
    </div>
    
    <div class="settings-group">
      <label class="settings-label">Theme</label>
      <div class="toggle-group">
        <div class="toggle-option active" data-value="light">Light</div>
        <div class="toggle-option" data-value="dark">Dark</div>
      </div>
    </div>
    
    <div class="settings-group">
      <div class="switch-container">
        <label class="settings-label">Auto-save drafts</label>
        <label class="switch">
          <input type="checkbox" id="autosave-toggle" checked>
          <span class="switch-slider"></span>
        </label>
      </div>
    </div>
  </div>
  
  <!-- Toast Notification -->
  <div id="toast" class="toast">
    <div class="toast-icon">✓</div>
    <span id="toast-message">URL copied to clipboard</span>
  </div>
  
  <script>
    let currentTags = [];
    let currentNodeName = '';
    let preferences = {
      layout: 'portrait',
      theme: 'light',
      autosave: true
    };
    let autosaveTimer = null;
    let allTags = []; // For tag suggestions
    
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize
      parent.postMessage({ pluginMessage: { type: 'get-metadata' } }, '*');
      parent.postMessage({ pluginMessage: { type: 'get-all-tags' } }, '*');
      
      // Settings panel toggle
      document.getElementById('settings-trigger').addEventListener('click', function() {
        const panel = document.getElementById('settings-panel');
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
      });
      
      document.getElementById('landscape-settings-trigger').addEventListener('click', function() {
        const panel = document.getElementById('settings-panel');
        panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
      });
      
      document.getElementById('close-settings').addEventListener('click', function() {
        document.getElementById('settings-panel').style.display = 'none';
      });
      
      // Settings options
      document.querySelectorAll('.toggle-option').forEach(option => {
        option.addEventListener('click', function() {
          // Update UI
          const parent = this.parentElement;
          parent.querySelectorAll('.toggle-option').forEach(opt => {
            opt.classList.remove('active');
          });
          this.classList.add('active');
          
          // Get setting type and value
          const settingType = parent.parentElement.querySelector('label').textContent.toLowerCase().trim();
          const value = this.getAttribute('data-value');
          
          // Update preferences
          if (settingType === 'layout') {
            preferences.layout = value;
            updateLayout(value);
          } else if (settingType === 'theme') {
            preferences.theme = value;
            updateTheme(value);
          }
          
          // Save preferences
          parent.postMessage({ 
            pluginMessage: { 
              type: 'update-preferences', 
              preferences 
            } 
          }, '*');
        });
      });
      
      // Autosave toggle
      document.getElementById('autosave-toggle').addEventListener('change', function() {
        preferences.autosave = this.checked;
        updateAutosave();
        
        // Save preferences
        parent.postMessage({ 
          pluginMessage: { 
            type: 'update-preferences', 
            preferences 
          } 
        }, '*');
      });
      
      // Tag input handling (Portrait)
      const tagInput = document.getElementById('tagInput');
      tagInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && this.value.trim() !== '') {
          addTag(this.value.trim());
          this.value = '';
          e.preventDefault();
          autosaveDraft();
        }
      });
      
      tagInput.addEventListener('input', function() {
        showTagSuggestions(this.value.trim(), 'tagSuggestions');
      });
      
      tagInput.addEventListener('blur', function() {
        setTimeout(() => {
          document.getElementById('tagSuggestions').style.display = 'none';
        }, 200);
      });
      
      // Tag input handling (Landscape)
      const landscapeTagInput = document.getElementById('landscapeTagInput');
      landscapeTagInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && this.value.trim() !== '') {
          addTag(this.value.trim());
          this.value = '';
          e.preventDefault();
          autosaveDraft();
        }
      });
      
      landscapeTagInput.addEventListener('input', function() {
        showTagSuggestions(this.value.trim(), 'landscapeTagSuggestions');
      });
      
      landscapeTagInput.addEventListener('blur', function() {
        setTimeout(() => {
          document.getElementById('landscapeTagSuggestions').style.display = 'none';
        }, 200);
      });
      
      // Source URL input for open/copy link buttons (Portrait)
      document.getElementById('sourceUrl').addEventListener('input', function() {
        const url = this.value.trim();
        const openLinkBtn = document.getElementById('openLink');
        const copyLinkBtn = document.getElementById('copyLink');
        
        if (url) {
          openLinkBtn.style.display = 'inline-flex';
          copyLinkBtn.style.display = 'inline-flex';
        } else {
          openLinkBtn.style.display = 'none';
          copyLinkBtn.style.display = 'none';
        }
        
        // Sync with landscape view
        document.getElementById('landscapeSourceUrl').value = url;
        syncUrlButtons();
        
        autosaveDraft();
      });
      
      // Source URL input for open/copy link buttons (Landscape)
      document.getElementById('landscapeSourceUrl').addEventListener('input', function() {
        const url = this.value.trim();
        
        // Sync with portrait view
        document.getElementById('sourceUrl').value = url;
        syncUrlButtons();
        
        autosaveDraft();
      });
      
      // Notes input (Portrait)
      document.getElementById('notes').addEventListener('input', function() {
        // Sync with landscape view
        document.getElementById('landscapeNotes').value = this.value;
        autosaveDraft();
      });
      
      // Notes input (Landscape)
      document.getElementById('landscapeNotes').addEventListener('input', function() {
        // Sync with portrait view
        document.getElementById('notes').value = this.value;
        autosaveDraft();
      });
      
      // Open link (Portrait)
      document.getElementById('openLink').addEventListener('click', function() {
        const url = document.getElementById('sourceUrl').value.trim();
        if (url) {
          window.open(url, '_blank');
        }
      });
      
      // Open link (Landscape)
      document.getElementById('landscapeOpenLink').addEventListener('click', function() {
        const url = document.getElementById('landscapeSourceUrl').value.trim();
        if (url) {
          window.open(url, '_blank');
        }
      });
      
      // Copy link (Portrait)
      document.getElementById('copyLink').addEventListener('click', function() {
        const url = document.getElementById('sourceUrl').value.trim();
        if (url) {
          navigator.clipboard.writeText(url).then(() => {
            showToast('URL copied to clipboard');
          });
        }
      });
      
      // Copy link (Landscape)
      document.getElementById('landscapeCopyLink').addEventListener('click', function() {
        const url = document.getElementById('landscapeSourceUrl').value.trim();
        if (url) {
          navigator.clipboard.writeText(url).then(() => {
            showToast('URL copied to clipboard');
          });
        }
      });
      
      // Save button (Portrait)
      document.getElementById('saveBtn').addEventListener('click', function() {
        saveMetadata();
      });
      
      // Save button (Landscape)
      document.getElementById('landscapeSaveBtn').addEventListener('click', function() {
        saveMetadata();
      });
      
      // Resize functionality
      const resizeHandle = document.getElementById('resize-handle');
      const landscapeResizeHandle = document.getElementById('landscape-resize-handle');
      
      let isResizing = false;
      let startWidth, startHeight;
      
      const startResize = (e) => {
        isResizing = true;
        startWidth = window.innerWidth;
        startHeight = window.innerHeight;
        document.addEventListener('mousemove', resize);
        document.addEventListener('mouseup', stopResize);
        e.preventDefault();
      };
      
      const resize = (e) => {
        if (!isResizing) return;
        
        const newWidth = startWidth + (e.clientX - startWidth);
        const newHeight = startHeight + (e.clientY - startHeight);
        
        // Minimum size constraints
        const minWidth = preferences.layout === 'landscape' ? 580 : 280;
        const minHeight = preferences.layout === 'landscape' ? 300 : 400;
        
        const width = Math.max(minWidth, newWidth);
        const height = Math.max(minHeight, newHeight);
        
        // Tell the plugin to resize
        parent.postMessage({
          pluginMessage: {
            type: 'resize',
            width,
            height
          }
        }, '*');
      };
      
      const stopResize = () => {
        isResizing = false;
        document.removeEventListener('mousemove', resize);
        document.removeEventListener('mouseup', stopResize);
      };
      
      resizeHandle.addEventListener('mousedown', startResize);
      landscapeResizeHandle.addEventListener('mousedown', startResize);
      
      // Listen for messages from the plugin
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;
        
        if (msg.type === 'init-preferences') {
          preferences = msg.preferences;
          updateLayout(preferences.layout);
          updateTheme(preferences.theme);
          updateAutosave();
          
          // Update autosave toggle
          document.getElementById('autosave-toggle').checked = preferences.autosave;
          
          // Update settings panel to match preferences
          document.querySelectorAll('.toggle-group').forEach(group => {
            const label = group.parentElement.querySelector('label').textContent.toLowerCase().trim();
            let value;
            
            if (label === 'layout') value = preferences.layout;
            else if (label === 'theme') value = preferences.theme;
            
            if (value) {
              group.querySelectorAll('.toggle-option').forEach(option => {
                option.classList.remove('active');
                if (option.getAttribute('data-value') === value) {
                  option.classList.add('active');
                }
              });
            }
          });
        }
        else if (msg.type === 'metadata-loaded') {
          displayMetadata(msg.data);
          updateLayerInfo(msg.nodeName);
          toggleEmptyState(false);
        } 
        else if (msg.type === 'draft-loaded') {
          displayMetadata(msg.data);
          updateLayerInfo(msg.nodeName);
          displayMessage('Continuing from your unsaved draft', 'info');
          toggleEmptyState(false);
          
          // Show draft indicator
          document.getElementById('status-indicator').style.display = 'flex';
          document.getElementById('landscape-status-indicator').style.display = 'flex';
        } 
        else if (msg.type === 'new-element') {
          clearForm();
          updateLayerInfo(msg.nodeName);
          displayMessage('Add metadata to this element', 'info');
          toggleEmptyState(false);
        } 
        else if (msg.type === 'no-selection') {
          displayMessage('Select an element to view or edit its metadata', 'warning');
          clearForm();
          toggleEmptyState(true);
        }
        else if (msg.type === 'selection-changed') {
          parent.postMessage({ pluginMessage: { type: 'get-metadata' } }, '*');
        }
        else if (msg.type === 'all-tags') {
          allTags = msg.tags || [];
        }
      };
      
      // Handle clicks outside the settings panel
      document.addEventListener('click', function(event) {
        const panel = document.getElementById('settings-panel');
        const settingsTrigger = document.getElementById('settings-trigger');
        const landscapeSettingsTrigger = document.getElementById('landscape-settings-trigger');
        const closeBtn = document.getElementById('close-settings');
        
        if (panel.style.display === 'block' && 
            !panel.contains(event.target) && 
            event.target !== settingsTrigger &&
            event.target !== landscapeSettingsTrigger &&
            event.target !== closeBtn &&
            !settingsTrigger.contains(event.target) &&
            !landscapeSettingsTrigger.contains(event.target)) {
          panel.style.display = 'none';
        }
      });
    });
    
    function showTagSuggestions(query, containerId) {
      const container = document.getElementById(containerId);
      
      // Clear previous suggestions
      container.innerHTML = '';
      
      if (!query || query.length < 2) {
        container.style.display = 'none';
        return;
      }
      
      // Filter tags based on query
      const filteredTags = allTags.filter(tag => 
        tag.toLowerCase().includes(query.toLowerCase()) && 
        !currentTags.includes(tag)
      );
      
      if (filteredTags.length === 0) {
        container.style.display = 'none';
        return;
      }
      
      // Create and append suggestion items
      filteredTags.slice(0, 5).forEach(tag => {
        const item = document.createElement('div');
        item.className = 'tag-suggestion-item';
        item.textContent = tag;
        
        item.addEventListener('click', () => {
          addTag(tag);
          
          // Clear input and hide suggestions
          if (containerId === 'tagSuggestions') {
            document.getElementById('tagInput').value = '';
          } else {
            document.getElementById('landscapeTagInput').value = '';
          }
          
          container.style.display = 'none';
          autosaveDraft();
        });
        
        container.appendChild(item);
      });
      
      container.style.display = 'block';
    }
    
    function updateLayout(layout) {
      if (layout === 'landscape') {
        document.getElementById('portrait-container').style.display = 'none';
        document.getElementById('landscape-container').style.display = 'flex';
      } else {
        document.getElementById('portrait-container').style.display = 'flex';
        document.getElementById('landscape-container').style.display = 'none';
      }
    }
    
    function updateTheme(theme) {
      if (theme === 'dark') {
        document.body.classList.add('dark-theme');
      } else {
        document.body.classList.remove('dark-theme');
      }
    }
    
    function updateAutosave() {
      if (preferences.autosave) {
        document.getElementById('status-indicator').style.display = 'flex';
        document.getElementById('landscape-status-indicator').style.display = 'flex';
      } else {
        document.getElementById('status-indicator').style.display = 'none';
        document.getElementById('landscape-status-indicator').style.display = 'none';
        
        // Clear any existing autosave timer
        if (autosaveTimer) {
          clearTimeout(autosaveTimer);
          autosaveTimer = null;
        }
      }
    }
    
    function syncUrlButtons() {
      const url = document.getElementById('sourceUrl').value.trim();
      const openLinkBtn = document.getElementById('openLink');
      const copyLinkBtn = document.getElementById('copyLink');
      const landscapeOpenLinkBtn = document.getElementById('landscapeOpenLink');
      const landscapeCopyLinkBtn = document.getElementById('landscapeCopyLink');
      
      if (url) {
        openLinkBtn.style.display = 'inline-flex';
        copyLinkBtn.style.display = 'inline-flex';
        landscapeOpenLinkBtn.style.display = 'inline-flex';
        landscapeCopyLinkBtn.style.display = 'inline-flex';
      } else {
        openLinkBtn.style.display = 'none';
        copyLinkBtn.style.display = 'none';
        landscapeOpenLinkBtn.style.display = 'none';
        landscapeCopyLinkBtn.style.display = 'none';
      }
    }
    
    function toggleEmptyState(show) {
      const emptyState = document.getElementById('empty-state');
      const landscapeEmptyState = document.getElementById('landscape-empty-state');
      const metadataForm = document.getElementById('metadata-form');
      const landscapeForm = document.querySelector('.landscape-main .form-group');
      const landscapeSaveBtn = document.getElementById('landscapeSaveBtn');
      
      if (show) {
        emptyState.style.display = 'flex';
        landscapeEmptyState.style.display = 'flex';
        metadataForm.style.display = 'none';
        landscapeForm.style.display = 'none';
        landscapeSaveBtn.style.display = 'none';
      } else {
        emptyState.style.display = 'none';
        landscapeEmptyState.style.display = 'none';
        metadataForm.style.display = 'block';
        landscapeForm.style.display = 'block';
        landscapeSaveBtn.style.display = 'flex';
      }
    }
    
    function updateLayerInfo(nodeName) {
      currentNodeName = nodeName;
      
      // Update portrait view
      document.getElementById('layerName').textContent = nodeName;
      document.getElementById('layer-info').style.display = 'flex';
      
      // Update landscape view
      document.getElementById('landscapeLayerName').textContent = nodeName;
      document.getElementById('landscape-layer-info').style.display = 'flex';
    }
    
    function displayMetadata(data) {
      // Clear any messages in both views
      document.getElementById('message-container').innerHTML = '';
      document.getElementById('landscape-message-container').innerHTML = '';
      
      const sourceUrl = data.sourceUrl || '';
      const notes = data.notes || '';
      
      // Update portrait view
      document.getElementById('sourceUrl').value = sourceUrl;
      document.getElementById('notes').value = notes;
      
      // Update landscape view
      document.getElementById('landscapeSourceUrl').value = sourceUrl;
      document.getElementById('landscapeNotes').value = notes;
      
      // Update link buttons in portrait view
      const openLinkBtn = document.getElementById('openLink');
      const copyLinkBtn = document.getElementById('copyLink');
      
      if (sourceUrl) {
        openLinkBtn.style.display = 'inline-flex';
        copyLinkBtn.style.display = 'inline-flex';
      } else {
        openLinkBtn.style.display = 'none';
        copyLinkBtn.style.display = 'none';
      }
      
      // Update link buttons in landscape view
      const landscapeOpenLinkBtn = document.getElementById('landscapeOpenLink');
      const landscapeCopyLinkBtn = document.getElementById('landscapeCopyLink');
      
      if (sourceUrl) {
        landscapeOpenLinkBtn.style.display = 'inline-flex';
        landscapeCopyLinkBtn.style.display = 'inline-flex';
      } else {
        landscapeOpenLinkBtn.style.display = 'none';
        landscapeCopyLinkBtn.style.display = 'none';
      }
      
      // Update tags
      currentTags = data.tags || [];
      updateTagsDisplay();
      updateLandscapeTagsDisplay();
    }
    
    function displayMessage(message, type = 'info') {
      // Create message element
      const messageElement = document.createElement('div');
      messageElement.className = `message ${type}`;
      
      // Add icon based on message type
      let iconSvg = '';
      let title = '';
      
      if (type === 'warning') {
        iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="message-icon">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>`;
        title = 'Attention';
      } else if (type === 'success') {
        iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="message-icon">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
          <polyline points="22 4 12 14.01 9 11.01"></polyline>
        </svg>`;
        title = 'Success';
      } else {
        iconSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="message-icon">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="16" x2="12" y2="12"></line>
          <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>`;
        title = 'Info';
      }
      
      messageElement.innerHTML = `
        ${iconSvg}
        <div class="message-content">
          <div class="message-title">${title}</div>
          <div class="message-text">${message}</div>
        </div>
      `;
      
      // Update both portrait and landscape views
      document.getElementById('message-container').innerHTML = '';
      document.getElementById('message-container').appendChild(messageElement.cloneNode(true));
      
      document.getElementById('landscape-message-container').innerHTML = '';
      document.getElementById('landscape-message-container').appendChild(messageElement);
    }
    
    function clearForm() {
      // Clear portrait view
      document.getElementById('sourceUrl').value = '';
      document.getElementById('notes').value = '';
      document.getElementById('openLink').style.display = 'none';
      document.getElementById('copyLink').style.display = 'none';
      
      // Clear landscape view
      document.getElementById('landscapeSourceUrl').value = '';
      document.getElementById('landscapeNotes').value = '';
      document.getElementById('landscapeOpenLink').style.display = 'none';
      document.getElementById('landscapeCopyLink').style.display = 'none';
      
      // Clear status indicators
      document.getElementById('status-indicator').style.display = 'none';
      document.getElementById('landscape-status-indicator').style.display = 'none';
      
      // Hide layer info
      document.getElementById('layer-info').style.display = 'none';
      document.getElementById('landscape-layer-info').style.display = 'none';
      
      // Clear tags
      currentTags = [];
      updateTagsDisplay();
      updateLandscapeTagsDisplay();
    }
    
    function addTag(tag) {
      if (!currentTags.includes(tag)) {
        currentTags.push(tag);
        updateTagsDisplay();
        updateLandscapeTagsDisplay();
      }
    }
    
    function removeTag(tag) {
      currentTags = currentTags.filter(t => t !== tag);
      updateTagsDisplay();
      updateLandscapeTagsDisplay();
      autosaveDraft();
    }
    
    function updateTagsDisplay() {
      const container = document.getElementById('tagsContainer');
      container.innerHTML = '';
      
      if (currentTags.length === 0) {
        return;
      }
      
      currentTags.forEach(tag => {
        const tagElement = document.createElement('div');
        tagElement.className = 'tag';
        tagElement.innerHTML = `${tag} <span class="tag-remove">×</span>`;
        
        tagElement.querySelector('.tag-remove').addEventListener('click', function() {
          removeTag(tag);
        });
        
        container.appendChild(tagElement);
      });
    }
    
    function updateLandscapeTagsDisplay() {
      const container = document.getElementById('landscapeTagsContainer');
      container.innerHTML = '';
      
      if (currentTags.length === 0) {
        return;
      }
      
      currentTags.forEach(tag => {
        const tagElement = document.createElement('div');
        tagElement.className = 'tag';
        tagElement.innerHTML = `${tag} <span class="tag-remove">×</span>`;
        
        tagElement.querySelector('.tag-remove').addEventListener('click', function() {
          removeTag(tag);
        });
        
        container.appendChild(tagElement);
      });
    }
    
    function saveMetadata() {
      // Get values from form
      const sourceUrl = document.getElementById('sourceUrl').value;
      const notes = document.getElementById('notes').value;
      
      parent.postMessage({
        pluginMessage: {
          type: 'save-metadata',
          sourceUrl,
          tags: currentTags,
          notes
        }
      }, '*');
      
      // Show success message
      displayMessage('Metadata saved successfully!', 'success');
      
      // Hide draft indicator
      document.getElementById('status-indicator').style.display = 'none';
      document.getElementById('landscape-status-indicator').style.display = 'none';
    }
    
    function autosaveDraft() {
      if (!preferences.autosave) return;
      
      // Clear any existing timer
      if (autosaveTimer) {
        clearTimeout(autosaveTimer);
      }
      
      // Set new timer to save after a short delay
      autosaveTimer = setTimeout(() => {
        // Get values from form
        const sourceUrl = document.getElementById('sourceUrl').value;
        const notes = document.getElementById('notes').value;
        
        parent.postMessage({
          pluginMessage: {
            type: 'save-draft',
            sourceUrl,
            tags: currentTags,
            notes
          }
        }, '*');
        
        // Show draft indicator
        document.getElementById('status-indicator').style.display = 'flex';
        document.getElementById('landscape-status-indicator').style.display = 'flex';
      }, 1000); // 1 second delay
    }
    
    function showToast(message) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      toastMessage.textContent = message;
      
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 2000);
    }
  </script>
</body>
</html>